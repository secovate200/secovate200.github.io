---
title: "[웹 해킹] 7.IDOR"
date: 2025-06-28 +0900
categories: ["Hacking", "IDOR"]
tags: [web, Backend]
mermaid: true
---

## IDOR (Insecure Direct Object Reference) 취약점 정리

IDOR는 인증된 사용자가 **다른 사용자의 리소스에 직접 접근할 수 있는 취약점**으로, 인증 및 권한 검증 로직이 누락되었거나 불충분할 때 발생합니다.

---

## 1. IDOR란?

**Insecure Direct Object Reference**

* 객체에 대한 직접적인 참조(ID, 파일명 등)가 존재하며,
* 그 객체에 대한 접근 권한 확인 없이 처리되는 경우

예시:

```http
GET /user/profile?user_id=1001
```

사용자 1002가 이 요청을 보내면 1001의 정보를 볼 수 있다면 IDOR 취약점 존재

---

## 2. 발생 위치

| 위치       | 설명                                 |
| -------- | ---------------------------------- |
| URL 파라미터 | `user_id=`, `file=`, `order_id=` 등 |
| POST 바디  | 폼 내부 `user_id`, `item_id` 필드 등     |
| 쿠키 값     | 세션 식별자, 사용자 ID 등                   |
| HTTP 헤더  | X-User-ID, API-Key 등               |

---

## 3. IDOR 공격 예시

### 3.1 URL 기반 IDOR

```http
GET /download?file=report_1001.pdf
→ file=report_1002.pdf 로 바꿔 요청 → 타인의 파일 다운로드 가능
```

### 3.2 API 기반 IDOR

```http
GET /api/user/1001/orders
→ 로그인된 사용자가 아닌데도 주문 정보를 열람 가능
```

### 3.3 모바일/앱 기반

* 앱 내 API 호출에서 사용자 ID 변경 → 서버가 검증 안 하면 IDOR 발생

### 3.4 파일 및 이미지

* `GET /uploads/image_1001.jpg` → 다른 번호로 변경 시 접근 가능 여부 확인

---

## 4. 수직 vs 수평 권한 상승

| 구분 | 설명                | 예시                  |
| -- | ----------------- | ------------------- |
| 수평 | 같은 권한 사용자 간 접근 우회 | 일반 사용자 A가 B의 정보를 조회 |
| 수직 | 상위 권한 기능 접근 시도    | 일반 사용자가 관리자 설정 접근   |

---

## 5. 우회 기법

* 숫자 순차 탐색 (`id=1`, `id=2`, ...)
* UUID, base64 등 추측 가능한 식별자 (약한 난수)
* 모바일 앱 / API 직접 호출
* Referer 조작 (간접 참조 방식 우회)
* 토큰 기반 인증 누락 API 탐색

---

## 6. 방어 방법

* **객체에 대한 권한 검증 필수**

  * 리소스를 반환하기 전 사용자 권한 확인

* **식별자 노출 최소화**

  * UUID 또는 해시 사용 (단, 이것만으로 충분하지 않음)

* **간접 참조 사용 (Indirect Object Reference)**

  * 실제 ID 대신 매핑된 키값 사용 (`ticket=ABCD1234` → 내부적으로 ID 1001)

* **접근 제어 일관성 유지**

  * 클라이언트에서 숨긴다고 보안이 되지 않음 → 서버 측 검증 필수

* **로깅 및 알림**

  * 권한 없는 접근 시도 로깅 및 관리자 알림 설정

---

## 7. 진단 방법

* Burp Suite 등으로 파라미터 조작 테스트
* 수동 요청 반복 (id 증가/변경)
* API 문서 분석 → 권한 검증 생략된 엔드포인트 탐지
* 모바일 앱/JS 분석 → 숨겨진 요청 확인

---

## 8. 요약 정리

| 항목    | 설명                           |
| ----- | ---------------------------- |
| 정의    | 인증 사용자가 다른 객체에 직접 접근 가능한 취약점 |
| 주요 위치 | URL, POST, 쿠키, 헤더 등          |
| 유형    | 수평, 수직 권한 상승                 |
| 공격 방식 | ID 변경, 객체 예측, API 조작 등       |
| 방어법   | 서버 측 권한 검증, 간접 참조, 로깅 등      |

---
